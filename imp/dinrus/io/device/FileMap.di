
module io.device.FileMap;

private import io.device.File,
               io.device.Array;

/*******************************************************************************

*******************************************************************************/


extern(D):

 class ФайлМэп : io.device.Array.Массив
{

        /***********************************************************************

                Конструирует ФайлМэп по заданному пути. 

                Нужно использовать перемерь() для установки доступного 
                рабочего пространства.

        ***********************************************************************/

        this (ткст путь, Файл.Стиль стиль = Файл.ЧитЗапОткр);

        /***********************************************************************

                Изменить размер файла и вернуть перекартированный контент. После
               этого вызова использовать карта() не требуется.

        ***********************************************************************/

        final ббайт[] перемерь (дол размер);

        /***********************************************************************

                Освободить внешние ресурсы.

        ***********************************************************************/

        override проц закрой ();
}


/*******************************************************************************

*******************************************************************************/

class КартированныйФайл
{

        /***********************************************************************

	        Конструирует ФайлМэп по заданному пути. 

	        Нужно использовать перемерь() для установки доступного 
	        рабочего пространства.

        ***********************************************************************/

        this (ткст путь, Файл.Стиль стиль = Файл.ЧитЗапОткр);
        final дол длина ();
        final ткст путь ();

        /***********************************************************************

                Изменяет размер файла и возвращает повторно картированный контент. После
                этого вызова использовать карта() не требуется.

        ***********************************************************************/

        final ббайт[] перемерь (дол размер);

                /***************************************************************

                        Вернуть срез, представляющий файл-контент, как 
                        размещённый в карте памяти Массив.

                ***************************************************************/

                final ббайт[] карта ();

                /***************************************************************

                        Освободить этот маппинг без слива.

                ***************************************************************/

                final проц закрой ();
				
                /***************************************************************

                        Слить грязный контент из драйва. Бывает провал
                        с ошибкой 33, если файл-контент девственен.
                        Открытию файла для ReadWriteExists
                        следует слей(), который это вызывает.

                ***************************************************************/

                КартированныйФайл слей ();

}